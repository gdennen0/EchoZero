name: AI Agent Quality Checks

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]

jobs:
  quality-checks:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run quality checks
      run: |
        python AgentAssets/scripts/quality_checks.py $(git diff --name-only HEAD~1)

    - name: Validate council decisions
      run: |
        find . -name "council_decision.json" -exec python AgentAssets/scripts/validate_council_decision.py {} \;

    - name: Run tests
      run: |
        python -m pytest tests/ -v

    - name: Check documentation
      run: |
        # Verify all Python files have docstrings
        python -c "
        import ast
        import os
        issues = []
        for root, dirs, files in os.walk('src'):
            for file in files:
                if file.endswith('.py'):
                    path = os.path.join(root, file)
                    try:
                        with open(path, 'r') as f:
                            tree = ast.parse(f.read())
                        for node in ast.walk(tree):
                            if isinstance(node, (ast.ClassDef, ast.FunctionDef)):
                                if not ast.get_docstring(node):
                                    issues.append(f'{path}:{node.lineno}: Missing docstring for {node.name}')
                    except:
                        pass
        if issues:
            print('Missing docstrings:')
            for issue in issues[:10]:  # Show first 10
                print(issue)
            if len(issues) > 10:
                print(f'... and {len(issues) - 10} more')
            exit(1)
        "

  ai-feedback-analysis:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Analyze AI agent performance
      run: |
        # This would integrate with your AI feedback system
        # For now, just check if the feedback system is working
        python AgentAssets/scripts/ai_feedback_system.py training_needs || echo "AI feedback system not yet populated"

    - name: Decision tracking analysis
      run: |
        python AgentAssets/scripts/decision_tracker.py analyze || echo "Decision tracker not yet populated"

